package com.cg.service;

import java.util.List;
import java.util.NoSuchElementException;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.cg.entity.OrderStatus;
import com.cg.entity.Orders;
import com.cg.iservice.IOrderService;
import com.cg.repository.OrderRepository;

import jakarta.persistence.criteria.Order;

@Service
public class OrderService implements IOrderService{
	    @Autowired
	    private OrderRepository orderRepo;
	    
	    @Override
	    public Orders create(Orders order) {
	            // Ensure defaults
	            if (order.getOrderStatus() == null) {
	                // default to PLACED
	                order.setOrderStatus(new OrderStatus("PLACED"));
	            }
	            return orderRepo.save(order);
	        }

	        @Override
	        @Transactional(readOnly = true)
	        public Optional<Orders> getById(Long orderId) {
	            return orderRepo.findById(orderId);
	        }

	        @Override
	        @Transactional(readOnly = true)
	        public List<Orders> getAll() {
	            return orderRepo.findAll();
	        }

	        @Override
	        public Orders update(Long orderId, Orders updated) {
	            Order existing = orderRepo.findById(orderId)
	                    .orElseThrow(() -> new NoSuchElementException("Order not found: " + orderId));

	            // Update only mutable fields
	            if (updated.getOrderDate() != null) existing.setOrderDate(updated.getOrderDate());
	            if (updated.getTotalAmount() != null) existing.setTotalAmount(updated.getTotalAmount());
	            if (updated.getCustomerId() != null) existing.setCustomerId(updated.getCustomerId());
	            if (updated.getRestaurantId() != null) existing.setRestaurantId(updated.getRestaurantId());
	            if (updated.getPaymentId() != null) existing.setPaymentId(updated.getPaymentId());
	            if (updated.getAgentId() != null) existing.setAgentId(updated.getAgentId());
	            if (updated.getOrderStatus() != null) existing.setOrderStatus(updated.getOrderStatus());

	            return orderRepo.save(existing);
	        }

	        @Override
	        public void delete(Long orderId) {
	            if (!orderRepo.existsById(orderId)) {
	                throw new NoSuchElementException("Order not found: " + orderId);
	            }
	            repo.deleteById(orderId);
	        }
}
